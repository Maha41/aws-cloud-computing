{
  "Resources":
  {
    "mycodeDeployPolicy":
    {
      "Type":"AWS::IAM::Policy",
      "Properties":
      {
          "PolicyName":"CodeDeploy-EC2-S3",
          "PolicyDocument":
          {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Action": [
                        "s3:Get*",
                        "s3:List*"
                    ],
                    "Effect": "Allow",
                    "Resource": "arn:aws:s3:::s3.csye6225-spring2018-srohil.me/*"
                }
            ]
          },
        }
      },
      "myTravistoS3Policy":
      {
        "Type":"AWS::IAM::Policy",
        "Properties":
        {
          "PolicyName":"Travis-Upload-To-S3",
          "PolicyDocument":
          {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Action": [
                        "s3:PutObject",
                    ],
                    "Effect": "Allow",
                    "Resource": "arn:aws:s3:::s3.csye6225-spring2018-srohil.me/*"
                }
            ]
          },
          "Users":["travis"]
        }
      },
      "myTravisCallToCodeDeployPolicy":
      {
        "Type":"AWS::IAM::Policy",
        "Properties":
        {
          "PolicyName":"Travis-Code-Deploy",
          "PolicyDocument":
          {
            "Version": "2012-10-17",
            "Statement":
            [

            ]
          },
          "Users":["travis"]
        }

      },
    "myEC2Role":
    {
      "Type": "AWS::IAM::Role",
      "Properties":
      {
        "RoleName":"CodeDeployEC2Service",
        "AssumeRolePolicyDocument":
        {

          "Fn::GetAtt":["mycodeDeployPolicy","PolicyDocument"]

        }
      }
    },
    "myCodeDeployRole":
    {
      "Type": "AWS::IAM::Role",
      "Properties":
      {
        "RoleName":"CodeDeployServiceRole",
        "AssumeRolePolicyDocument":
        {
          "Version": "2012-10-17",
          "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "autoscaling:CompleteLifecycleAction",
                "autoscaling:DeleteLifecycleHook",
                "autoscaling:DescribeAutoScalingGroups",
                "autoscaling:DescribeLifecycleHooks",
                "autoscaling:PutLifecycleHook",
                "autoscaling:RecordLifecycleActionHeartbeat",
                "autoscaling:CreateAutoScalingGroup",
                "autoscaling:UpdateAutoScalingGroup",
                "autoscaling:EnableMetricsCollection",
                "autoscaling:DescribeAutoScalingGroups",
                "autoscaling:DescribePolicies",
                "autoscaling:DescribeScheduledActions",
                "autoscaling:DescribeNotificationConfigurations",
                "autoscaling:DescribeLifecycleHooks",
                "autoscaling:SuspendProcesses",
                "autoscaling:ResumeProcesses",
                "autoscaling:AttachLoadBalancers",
                "autoscaling:PutScalingPolicy",
                "autoscaling:PutScheduledUpdateGroupAction",
                "autoscaling:PutNotificationConfiguration",
                "autoscaling:PutLifecycleHook",
                "autoscaling:DescribeScalingActivities",
                "autoscaling:DeleteAutoScalingGroup",
                "ec2:DescribeInstances",
                "ec2:DescribeInstanceStatus",
                "ec2:TerminateInstances",
                "tag:GetTags",
                "tag:GetResources",
                "sns:Publish",
                "cloudwatch:DescribeAlarms",
                "cloudwatch:PutMetricAlarm",
                "elasticloadbalancing:DescribeLoadBalancers",
                "elasticloadbalancing:DescribeInstanceHealth",
                "elasticloadbalancing:RegisterInstancesWithLoadBalancer",
                "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",
                "elasticloadbalancing:DescribeTargetGroups",
                "elasticloadbalancing:DescribeTargetHealth",
                "elasticloadbalancing:RegisterTargets",
                "elasticloadbalancing:DeregisterTargets"
            ],
            "Resource": "*"
        }
                        ]
        }

        }
    }

  }



}
